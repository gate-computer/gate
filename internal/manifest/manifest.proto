// Copyright (c) 2019 Timo Savola. All rights reserved.
// Use of this source code is governed by a BSD-style
// license that can be found in the LICENSE file.

syntax = "proto3";

package manifest;

message ByteRange {
	int64 offset = 1;
	int64 length = 2;
}

message Program {
	int32 init_routine = 1;
	uint64 text_addr = 2;   // Nonzero if suspended.
	uint32 text_size = 3;
	uint32 stack_usage = 4; // Nonzero if suspended.
	uint32 globals_size = 5;
	uint32 memory_data_size = 6;
	uint32 memory_size = 7;
	uint32 memory_size_limit = 8;
	int64 module_size = 9;
	repeated ByteRange sections = 10;
	ByteRange service_section = 11;
	ByteRange io_section = 12;
	ByteRange buffer_section = 13;
	ByteRange stack_section = 14;
	bytes global_types = 15;                // Limited by wag's maxGlobals check.
	map<string, uint32> entry_indexes = 16; // Limited by func name len and wag's maxExports check.
	map<uint32, uint32> entry_addrs = 17;
	uint32 call_sites_size = 18;
	uint32 func_addrs_size = 19;
	bool random_seed = 20;
}

message Instance {
	int32 init_routine = 1;
	uint64 text_addr = 2;   // Nonzero if suspended.
	uint32 stack_size = 3;
	uint32 stack_usage = 4; // Nonzero if suspended.
	uint32 globals_size = 5;
	uint32 memory_size = 6;
	uint32 max_memory_size = 7;
	uint32 entry_index = 8;
	uint32 entry_addr = 9;
}
